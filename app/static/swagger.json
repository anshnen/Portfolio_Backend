{
  "openapi": "3.0.0",
  "info": {
    "title": "Brokerage API",
    "description": "A comprehensive REST API for a brokerage platform, supporting portfolio management, market data, orders, and watchlists.",
    "version": "1.5.0"
  },
  "servers": [
    {
      "url": "/api/v1"
    }
  ],
  "tags": [
    { "name": "Portfolio", "description": "High-level portfolio and account management." },
    { "name": "Market Data", "description": "Endpoints for searching and retrieving asset information." },
    { "name": "Orders", "description": "Endpoints for placing and managing trades." },
    { "name": "Transactions", "description": "Endpoints for viewing financial history." },
    { "name": "Watchlists", "description": "Endpoints for managing user watchlists." }
  ],
  "paths": {
    "/portfolio/{portfolio_id}/summary": {
      "get": {
        "tags": ["Portfolio"],
        "summary": "Get Portfolio Summary",
        "description": "Retrieves a full summary of a portfolio, including P&L, market indices, insights, and accounts.",
        "parameters": [ { "$ref": "#/components/parameters/PortfolioId" } ],
        "responses": {
          "200": { "description": "A successful response with the portfolio summary.", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PortfolioSummary" } } } },
          "404": { "description": "Portfolio not found." }
        }
      }
    },
     "/portfolio/{portfolio_id}/holdings": {
      "get": {
        "tags": ["Portfolio"],
        "summary": "Get Detailed Holdings",
        "description": "Retrieves a detailed list of all individual asset holdings for a portfolio.",
        "parameters": [ { "$ref": "#/components/parameters/PortfolioId" } ],
        "responses": {
          "200": { "description": "A list of detailed holdings.", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/DetailedHolding" } } } } }
        }
      }
    },
    "/accounts/portfolio/{portfolio_id}": {
      "get": {
        "tags": ["Portfolio"],
        "summary": "Get All Accounts for a Portfolio",
        "parameters": [ { "$ref": "#/components/parameters/PortfolioId" } ],
        "responses": {
          "200": { "description": "A list of accounts.", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Account" } } } } }
        }
      }
    },
    "/accounts/{account_id}/funds": {
      "post": {
        "tags": ["Portfolio"],
        "summary": "Deposit or Withdraw Funds",
        "parameters": [ { "$ref": "#/components/parameters/AccountId" } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ManageFunds" } } } },
        "responses": {
          "200": { "description": "Funds managed successfully." },
          "400": { "description": "Invalid input or insufficient funds." }
        }
      }
    },
    "/market/search": {
      "get": {
        "tags": ["Market Data"],
        "summary": "Search for Assets",
        "parameters": [ { "name": "q", "in": "query", "required": true, "schema": { "type": "string" }, "example": "Apple" } ],
        "responses": {
          "200": { "description": "A list of matching assets.", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/AssetSearchResult" } } } } }
        }
      }
    },
    "/market/asset/{ticker}": {
      "get": {
        "tags": ["Market Data"],
        "summary": "Get Asset Details",
        "parameters": [ { "$ref": "#/components/parameters/TickerSymbol" } ],
        "responses": {
          "200": { "description": "Detailed asset information.", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AssetDetails" } } } },
          "404": { "description": "Asset not found." }
        }
      }
    },
    "/orders": {
      "post": {
        "tags": ["Orders"],
        "summary": "Place an Order",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewOrder" } } } },
        "responses": {
          "201": { "description": "Order placed successfully." },
          "400": { "description": "Invalid input." }
        }
      }
    },
    "/transactions/account/{account_id}": {
      "get": {
        "tags": ["Transactions"],
        "summary": "Get Transactions for Account",
        "parameters": [ { "$ref": "#/components/parameters/AccountId" } ],
        "responses": {
          "200": { "description": "A list of transactions.", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Transaction" } } } } }
        }
      }
    },
    "/watchlists/{portfolio_id}": {
      "get": {
        "tags": ["Watchlists"],
        "summary": "Get All Watchlists",
        "parameters": [ { "$ref": "#/components/parameters/PortfolioId" } ],
        "responses": { "200": { "description": "A list of watchlists.", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Watchlist" } } } } } }
      }
    },
     "/watchlists/{watchlist_id}": {
        "patch": {
            "tags": ["Watchlists"],
            "summary": "Rename a Watchlist",
            "parameters": [ { "$ref": "#/components/parameters/WatchlistId" } ],
            "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RenameWatchlist" } } } },
            "responses": { "200": { "description": "Watchlist renamed." }, "400": { "description": "Invalid input." }, "404": {"description": "Watchlist not found."}}
        },
        "delete": {
            "tags": ["Watchlists"],
            "summary": "Delete a Watchlist",
            "parameters": [ { "$ref": "#/components/parameters/WatchlistId" } ],
            "responses": { "200": { "description": "Watchlist deleted." }, "404": { "description": "Watchlist not found." } }
        }
    },
    "/watchlists/{watchlist_id}/items": {
      "post": {
        "tags": ["Watchlists"],
        "summary": "Add Item to Watchlist",
        "parameters": [ { "$ref": "#/components/parameters/WatchlistId" } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewWatchlistItem" } } } },
        "responses": { "201": { "description": "Item added." }, "400": { "description": "Invalid input." } }
      }
    },
    "/watchlists/{watchlist_id}/items/{ticker}": {
      "delete": {
        "tags": ["Watchlists"],
        "summary": "Remove Item from Watchlist by Ticker",
        "parameters": [ { "$ref": "#/components/parameters/WatchlistId" }, { "$ref": "#/components/parameters/TickerSymbol" } ],
        "responses": { "200": { "description": "Item removed." }, "404": { "description": "Item not found." } }
      }
    }
  },
  "components": {
    "parameters": {
      "PortfolioId": { "name": "portfolio_id", "in": "path", "required": true, "schema": { "type": "integer", "example": 1 } },
      "AccountId": { "name": "account_id", "in": "path", "required": true, "schema": { "type": "integer", "example": 1 } },
      "WatchlistId": { "name": "watchlist_id", "in": "path", "required": true, "schema": { "type": "integer", "example": 1 } },
      "TickerSymbol": { "name": "ticker", "in": "path", "required": true, "schema": { "type": "string", "example": "AAPL" } }
    },
    "schemas": {
      "Account": { "type": "object", "properties": { "id": { "type": "integer" }, "name": { "type": "string" }, "account_type": { "type": "string" }, "balance": { "type": "number", "format": "float" } } },
      "MarketIndex": { "type": "object", "properties": { "name": { "type": "string" }, "ticker": { "type": "string" }, "price": { "type": "number" }, "change_percent": { "type": "number" } } },
      "PortfolioSummary": { "type": "object", "properties": { "net_worth": { "type": "number" }, "performance": { "type": "object", "properties": { "total_initial_investment": { "type": "number" }, "current_holdings_worth": { "type": "number" }, "overall_pl": { "type": "number" }, "overall_pl_percent": { "type": "number" }, "todays_change_amount": { "type": "number" } } }, "market_indices": { "type": "array", "items": { "$ref": "#/components/schemas/MarketIndex" } }, "detailed_holdings": { "type": "array", "items": { "$ref": "#/components/schemas/DetailedHolding" } }, "accounts": { "type": "array", "items": { "$ref": "#/components/schemas/Account" } }, "insights": { "type": "object" } } },
      "DetailedHolding": { "type": "object", "properties": { "holding_id": { "type": "integer" }, "ticker_symbol": { "type": "string" }, "quantity": { "type": "number" }, "average_buy_price": { "type": "number" }, "current_price": { "type": "number" }, "market_value": { "type": "number" }, "unrealized_pnl": { "type": "number" } } },
      "AssetSearchResult": { "type": "object", "properties": { "ticker": { "type": "string" }, "name": { "type": "string" } } },
      "AssetDetails": { "type": "object", "properties": { "asset_id": { "type": "integer" }, "name": { "type": "string" }, "last_price": { "type": "number" }, "fundamentals": { "type": "object" }, "technicals": { "type": "object" }, "historical_data": { "type": "array", "items": { "type": "object" } } } },
      "NewOrder": { "type": "object", "properties": { "account_id": { "type": "integer" }, "ticker": { "type": "string" }, "quantity": { "type": "number" }, "transaction_type": { "type": "string", "enum": [ "BUY", "SELL" ] }, "order_type": { "type": "string", "enum": [ "MARKET", "LIMIT", "STOP_LOSS" ] }, "trigger_price": { "type": "number" } }, "required": [ "account_id", "ticker", "quantity", "transaction_type", "order_type" ] },
      "Transaction": { "type": "object", "properties": { "id": { "type": "integer" }, "transaction_type": { "type": "string" } } },
      "Watchlist": { "type": "object", "properties": { "id": { "type": "integer" }, "name": { "type": "string" }, "items": { "type": "array", "items": { "$ref": "#/components/schemas/WatchlistItem" } } } },
      "WatchlistItem": { "type": "object", "properties": { "asset_id": { "type": "integer" }, "ticker_symbol": { "type": "string" } } },
      "NewWatchlist": { "type": "object", "properties": { "portfolio_id": { "type": "integer" }, "name": { "type": "string" } }, "required": [ "portfolio_id", "name" ] },
      "RenameWatchlist": { "type": "object", "properties": { "name": { "type": "string", "example": "Updated Watchlist Name" } }, "required": [ "name" ] },
      "NewWatchlistItem": { "type": "object", "properties": { "ticker": { "type": "string" } }, "required": [ "ticker" ] },
      "ManageFunds": { "type": "object", "properties": { "action": { "type": "string", "enum": [ "DEPOSIT", "WITHDRAWAL" ] }, "amount": { "type": "number" } }, "required": [ "action", "amount" ] }
    }
  }
}